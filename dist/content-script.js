(()=>{let t=null;const e=()=>{t&&(t.remove(),t=null)};document.addEventListener("mouseup",(async()=>{const n=window.getSelection(),o=n.toString().trim();if(t&&e(),o&&!document.getElementById("tooltip-popup")){const r=document.createElement("div");r.id="tooltip-popup",r.classList.add("tooltip");const i=n.getRangeAt(0),s=i.getBoundingClientRect();r.style.top=`${s.bottom+window.scrollY+10}px`,r.style.left=`${s.left+window.scrollX}px`,r.innerHTML='<div class="tooltip-content">Analyzing...</div>',document.body.appendChild(r),t=r;const c=function(t){const e=t.commonAncestorContainer,n=(3===e.nodeType?e.parentElement:e).textContent||"";return console.log("CONTEXT_TEXT:",n),n}(i);try{const n=await async function(t,e){try{return new Promise(((n,o)=>{chrome.runtime.sendMessage({action:"analyzeText",text:t,context:e},(t=>{if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void o(chrome.runtime.lastError.message);t.success?n(t.result):o(t.error||"Unknown error")}))}))}catch(t){return console.error("Error analyzing text:",t),"Error analyzing text"}}(o,c),r=await async function(t,e){try{return new Promise(((n,o)=>{chrome.runtime.sendMessage({action:"getDefinition",text:t,context:e},(t=>{if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void o(chrome.runtime.lastError.message);t.success?n(t.result):o(t.error||"Unknown error")}))}))}catch(t){return console.error("Error getting definition of the text:",t),"Error getting definition of the text"}}(o,c);if(t){t.innerHTML=`\n        <div class="tooltip-content">\n          <span id="tooltip--text">${o}</span>\n          <span id="toolltip-definition">${r}</span>\n          <span id="tooltip-analysis">${n}</span>\n        </div>\n        `;const i=document.createElement("span");i.classList.add("close-btn"),i.innerHTML="Ã—",i.onclick=e,t.appendChild(i)}}catch(e){t&&(t.innerHTML=`<div class="tooltip-content">Error: ${e}</div>`)}}})),document.addEventListener("mousedown",(n=>{t&&!t.contains(n.target)&&e()}))})();