(()=>{let t=null;const e=()=>{t&&(t.remove(),t=null)};document.addEventListener("mouseup",(async()=>{const n=window.getSelection(),o=n.toString().trim();if(t&&e(),o&&!document.getElementById("tooltip-popup")){const r=document.createElement("div");r.id="tooltip-popup",r.classList.add("tooltip");const s=n.getRangeAt(0),i=s.getBoundingClientRect();r.style.position="absolute",r.style.top=`${i.bottom+window.scrollY+10}px`,r.style.left=`${i.left+window.scrollX}px`,r.innerHTML='<div class="tooltip-content">Analyzing...</div>',document.body.appendChild(r),t=r;const c=function(t){const e=t.commonAncestorContainer,n=(3===e.nodeType?e.parentElement:e).textContent||"";return console.log("Context text:",n),n}(s);try{const n=await async function(t,e){try{return new Promise(((n,o)=>{chrome.runtime.sendMessage({action:"analyzeText",text:t,context:e},(t=>{if(chrome.runtime.lastError)return console.error("Error sending message:",chrome.runtime.lastError),void o(chrome.runtime.lastError.message);t.success?n(t.result):o(t.error||"Unknown error")}))}))}catch(t){return console.error("Error analyzing text:",t),"Error analyzing text"}}(o,c);if(t){t.innerHTML=`<div class="tooltip-content">${n}</div>`;const o=document.createElement("span");o.classList.add("close-btn"),o.innerHTML="Ã—",o.onclick=e,t.appendChild(o)}}catch(e){t&&(t.innerHTML=`<div class="tooltip-content">Error: ${e}</div>`)}}})),document.addEventListener("mousedown",(n=>{t&&!t.contains(n.target)&&e()}))})();