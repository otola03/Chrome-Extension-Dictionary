(()=>{let t=null;const n=()=>{t&&(console.log("Tooltip Removed"),t.remove(),t=null)};document.addEventListener("mouseup",(async()=>{const e=window.getSelection(),o=e.toString().trim();if(o&&!document.getElementById("tooltip-popup")){const r=document.createElement("div");r.id="tooltip-popup",r.classList.add("tooltip");const i=e.getRangeAt(0),s=i.getBoundingClientRect();r.style.top=`${s.bottom+window.scrollY+10}px`,r.style.left=`${s.left+window.scrollX}px`,r.innerHTML='<div class="tooltip-content">Analyzing...</div>',document.body.appendChild(r),t=r;const l=function(t){const n=t.commonAncestorContainer,e=(3===n.nodeType?n.parentElement:n).textContent||"";return console.log("CONTEXT_TEXT:",e),e}(i);try{const e=await async function(t,n){try{return new Promise(((e,o)=>{chrome.runtime.sendMessage({action:"getDefinition",text:t,context:n},(t=>{if(chrome.runtime.lastError)return console.error("Error sending message (get definition):",chrome.runtime.lastError),void o(chrome.runtime.lastError.message);t.success?e(t.result):o(t.error||"Unknown error")}))}))}catch(t){return console.error("Error getting definition of the text:",t),"Error getting definition of the text"}}(o,l),r=(await async function(t,n){try{return new Promise(((e,o)=>{chrome.runtime.sendMessage({action:"analyzeText",text:t,context:n},(t=>{if(chrome.runtime.lastError)return console.error("Error sending message (analyze text):",chrome.runtime.lastError),void o(chrome.runtime.lastError.message);t.success?e(t.result):o(t.error||"Unknown error")}))}))}catch(t){return console.error("Error analyzing text:",t),"Error analyzing text"}}(o,l)).slice(0,-1);t&&(t.innerHTML=`\n        <button class="btn" id="close-btn">Ã—</button>\n        <div class="tooltip-content">\n          <span id="tooltip-text">${o}</span>\n          <span id="tooltip-definition">${e}</span>\n          <button class="btn" id="tooltip-btn">\n            <span id="tooltip-btn-plus">+</span>\n            <span id="tooltip-btn-text">Show Explanation</span>\n          </button>\n        </div>\n        `),document.getElementById("tooltip-btn").addEventListener("click",(async()=>{t&&(console.log("Analysis:",r),t.insertAdjacentHTML("beforeend",`<span id="tooltip-analysis">${r}</span>`),document.getElementById("tooltip-btn").remove())})),document.getElementById("close-btn").addEventListener("click",n)}catch(n){t&&(t.innerHTML=`<div class="tooltip-content">Error: ${n}</div>`)}}}))})();